<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzans Cloud Pro - Layout Fixed</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { --blue: #0969da; --accent: #2da44e; --border: #d0d7de; --bg: #f6f8fa; --text: #1f2328; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); }
        .main-container { max-width: 600px; margin: 0 auto; padding: 15px; }
        
        /* Header & Nav */
        .header { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        
        /* Style baru untuk Link MUZANS */
        .logo-link { text-decoration: none; color: var(--blue); transition: opacity 0.2s; }
        .logo-link:hover { opacity: 0.7; }
        
        .nav-tools { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
        
        .view-controls { display: flex; gap: 5px; background: #f0f0f0; padding: 4px; border-radius: 8px; }
        .view-btn { border: none; background: transparent; padding: 8px 12px; cursor: pointer; border-radius: 6px; color: #57606a; }
        .view-btn.active { background: white; color: var(--blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-upload { background: var(--accent); color: white; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; border: none; display: flex; align-items: center; gap: 8px; }

        /* Container File */
        .file-grid { display: grid; gap: 12px; }

        /* --- 1. MODE IKON BESAR (Setengah Ukuran, Menurun) --- */
        .mode-large { grid-template-columns: 1fr; }
        .mode-large .preview-box { height: 180px; font-size: 4rem; }
        .mode-large .file-card { flex-direction: column; }

        /* --- 2. MODE KOTAK-KOTAK (Grid 2 Kolom) --- */
        .mode-grid { grid-template-columns: repeat(2, 1fr); }
        .mode-grid .preview-box { height: 120px; font-size: 2.5rem; }
        .mode-grid .file-card { flex-direction: column; }

        /* --- 3. MODE DETAIL (List Baris) --- */
        .mode-detail { grid-template-columns: 1fr; gap: 6px; }
        .mode-detail .file-card { flex-direction: row; align-items: center; padding: 8px 12px; height: 60px; }
        .mode-detail .preview-box { width: 40px; height: 40px; border: none; font-size: 1.2rem; margin-right: 12px; background: transparent; border-bottom: none; }
        .mode-detail .file-info { text-align: left; padding: 0; }
        .mode-detail .actions { border: none; margin-left: auto; width: auto; }
        .mode-detail .btn-action { padding: 8px; }

        /* Dasar Card */
        .file-card { background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; display: flex; transition: 0.2s; }
        .preview-box { background: #fafafa; display: flex; align-items: center; justify-content: center; cursor: pointer; border-bottom: 1px solid #eee; }
        .preview-box img { width: 100%; height: 100%; object-fit: cover; }
        .preview-box i { color: #ccc; }

        .file-info { padding: 10px; flex-grow: 1; min-width: 0; text-align: center; }
        .file-name { font-size: 0.85rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
        .file-meta { font-size: 0.7rem; color: #57606a; margin-top: 2px; }

        .actions { display: flex; border-top: 1px solid #eee; }
        .btn-action { flex: 1; padding: 10px; border: none; background: white; cursor: pointer; color: #57606a; border-right: 1px solid #eee; }
        .btn-action:last-child { border-right: none; }
        .btn-action:hover { color: var(--blue); background: #f8f9fa; }

        /* Modal */
        #previewModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { width: 90%; max-width: 400px; background: white; border-radius: 15px; overflow: hidden; position: relative; }
        .close-modal { position: absolute; top: 10px; right: 10px; background: var(--blue); color: white; border-radius: 50%; width: 30px; height: 30px; border: none; cursor: pointer; z-index: 20; }
    </style>
</head>
<body>

<div id="previewModal">
    <div class="modal-content">
        <button class="close-modal" onclick="closePreview()"><i class="fa-solid fa-xmark"></i></button>
        <div id="modalBody"></div>
    </div>
</div>

<div class="main-container">
    <header class="header">
        <div class="top-bar">
            <a href="https://muzans.github.io" class="logo-link">
                <h1><b style="color:var(--blue)">MUZANS</b></h1>
            </a>
            <label class="btn-upload">
                <i class="fa-solid fa-cloud-arrow-up"></i> Upload
                <input type="file" id="fileInput" hidden onchange="uploadToGithub()">
            </label>
        </div>
        <div class="nav-tools">
            <div class="view-controls">
                <button class="view-btn active" onclick="changeView('large', this)" title="Besar"><i class="fa-solid fa-square"></i></button>
                <button class="view-btn" onclick="changeView('grid', this)" title="Grid"><i class="fa-solid fa-grip-vertical"></i></button>
                <button class="view-btn" onclick="changeView('detail', this)" title="Detail"><i class="fa-solid fa-list-ul"></i></button>
            </div>
            <div id="fileCount" style="font-size:0.8rem">Memuat...</div>
        </div>
    </header>

    <div id="fileGrid" class="file-grid mode-large"></div>
</div>

<script>
    // Konfigurasi API tetap sama
    const FIREBASE_URL = "https://cloudmuzans-default-rtdb.asia-southeast1.firebasedatabase.app/github_token.json";
    const GITHUB = { token: '', owner: 'muzans', repo: 'muzanscloud.github.io', path: 'uploads' };

    async function init() {
        try {
            const res = await fetch(FIREBASE_URL);
            GITHUB.token = await res.json();
            loadFiles();
        } catch (e) { document.getElementById('fileCount').innerText = "Error Token"; }
    }

    function getIcon(name) {
        const ext = name.split('.').pop().toLowerCase();
        if (['jpg','jpeg','png','gif','webp'].includes(ext)) return 'img';
        if (['mp4','webm'].includes(ext)) return 'fa-solid fa-play-circle';
        if (['zip','rar'].includes(ext)) return 'fa-solid fa-file-zipper';
        if (ext === 'apk') return 'fa-brands fa-android';
        return 'fa-solid fa-file';
    }

    async function loadFiles() {
        const grid = document.getElementById('fileGrid');
        try {
            const res = await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}?t=${Date.now()}`, {
                headers: { 'Authorization': `token ${GITHUB.token}` }
            });
            const files = await res.json();
            grid.innerHTML = '';
            document.getElementById('fileCount').innerText = `${files.length} File tersimpan`;
            
            files.forEach(file => {
                const type = getIcon(file.name);
                const card = document.createElement('div');
                card.className = 'file-card';
                card.innerHTML = `
                    <div class="preview-box" onclick="handlePreview('${file.download_url}', '${file.name}')">
                        ${type === 'img' ? `<img src="${file.download_url}">` : `<i class="${type}"></i>`}
                    </div>
                    <div class="file-info">
                        <span class="file-name">${file.name}</span>
                        <div class="file-meta">${(file.size/1024).toFixed(1)} KB â€¢ 23 Jan 2026</div>
                    </div>
                    <div class="actions">
                        <button class="btn-action" onclick="window.open('${file.download_url}')"><i class="fa-solid fa-download"></i></button>
                        <button class="btn-action" onclick="deleteFile('${file.name}', '${file.sha}')"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
                grid.appendChild(card);
            });
        } catch (err) { grid.innerHTML = 'Gagal memuat file.'; }
    }

    function changeView(mode, btn) {
        document.getElementById('fileGrid').className = `file-grid mode-${mode}`;
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function handlePreview(url, name) {
        const modal = document.getElementById('previewModal');
        const body = document.getElementById('modalBody');
        const ext = name.split('.').pop().toLowerCase();
        modal.style.display = 'flex';
        
        if (['jpg','jpeg','png','gif','webp'].includes(ext)) {
            body.innerHTML = `<img src="${url}" style="width:100%; max-height:70vh; object-fit:contain; display:block;">`;
        } else {
            body.innerHTML = `<div style="padding:40px; text-align:center;"><i class="${getIcon(name)}" style="font-size:3rem; color:#ccc;"></i><br><br><span style="font-size:0.9rem">${name}</span></div>`;
        }
    }

    function closePreview() { document.getElementById('previewModal').style.display = 'none'; }

    async function deleteFile(name, sha) {
        if (!confirm('Hapus file ini?')) return;
        await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}/${name}`, {
            method: 'DELETE',
            headers: { 'Authorization': `token ${GITHUB.token}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: 'Delete file', sha: sha })
        });
        loadFiles();
    }

    init();
</script>
</body>
</html>
