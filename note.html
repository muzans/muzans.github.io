<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Dashboard Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #2ecc71;
            --danger-color: #ff4757;
            --dark-color: #2c3e50;
            --bg-color: #f4f7f9;
            --white: #ffffff;
            --textbox-height: 200px;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }

        header {
            background: var(--white); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;
        }

        /* Perbaikan Tombol Home Logo */
        .header-left .header-logo { 
            font-weight: 800; 
            font-size: 18px; 
            color: var(--dark-color); 
            text-decoration: none; 
            display: flex; 
            align-items: center; 
            gap: 10px;
            transition: 0.2s;
        }
        .header-left .header-logo:hover { color: var(--primary-color); }

        .header-icons { display: flex; align-items: center; gap: 15px; position: relative; }
        .icon-btn { background: none; border: none; font-size: 24px; color: #777; cursor: pointer; transition: 0.2s; }
        
        .login-popup {
            position: absolute; top: 50px; right: 0; background: var(--white); border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15); padding: 20px; width: 260px; display: flex; flex-direction: column; gap: 12px; z-index: 1001; border: 1px solid #eee;
        }

        .login-popup input[type="email"], .login-popup input[type="password"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        
        .remember-me { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #666; cursor: pointer; user-select: none; }

        .btn { padding: 10px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; text-align: center; }
        .btn-login { background: var(--primary-color); color: white; width: 100%; }
        .btn-logout { background: var(--danger-color); color: white; width: 100%; }
        .btn-edit { background: var(--dark-color); color: white; }
        .btn-save { background: var(--secondary-color); color: white; flex: 1; }
        .btn-cancel { background: #95a5a6; color: white; flex: 1; }
        .btn-delete { background: var(--danger-color); color: white; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; flex: 1; }
        .admin-box { background: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .admin-box input, .admin-box textarea { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

        .notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }

        .card { background: white; padding: 18px; border-radius: 12px; border: 1px solid #e1e8ed; display: flex; flex-direction: column; position: relative; }
        .card-title { font-weight: 800; font-size: 16px; margin-bottom: 10px; border: 1px solid transparent; width: 100%; padding: 5px; box-sizing: border-box; }
        .card-title.editing { border: 1px solid var(--primary-color); border-radius: 4px; background: #fff; }

        textarea.fixed-height {
            width: 100%; height: var(--textbox-height); border: 1px solid #f0f4f8; background: #f9fbff;
            font-size: 14px; line-height: 1.5; resize: none; padding: 10px; border-radius: 8px; box-sizing: border-box; overflow-y: auto;
        }
        textarea.fixed-height.editing { background: #fff; border: 1px solid var(--primary-color); }
        
        .card-actions { display: flex; gap: 8px; margin-top: 15px; padding-top: 12px; border-top: 1px solid #eee; align-items: center; }
        
        .status-saved { color: #1da1f2; font-size: 18px; margin-left: auto; display: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <a href="https://muzans.github.io" class="header-logo">
            <i class="fas fa-home"></i> LINK DASHBOARD
        </a>
    </div>
    <div class="header-icons">
        <span id="admin-label" class="hidden" style="font-size: 11px; font-weight: bold; color: var(--secondary-color); margin-right: 5px;">ADMIN MODE</span>
        <button id="login-trigger" class="icon-btn" onclick="togglePopup(event)"><i class="fas fa-user-circle"></i></button>

        <div id="login-popup" class="login-popup hidden">
            <div id="login-form">
                <input type="email" id="login-email" placeholder="Email Admin">
                <input type="password" id="login-pass" placeholder="Password">
                <label class="remember-me">
                    <input type="checkbox" id="remember-check"> Ingat Saya
                </label>
                <button class="btn btn-login" style="margin-top: 5px;" onclick="login()">Login</button>
            </div>
            <div id="logout-form" class="hidden">
                <p style="font-size: 13px; text-align: center; margin: 0 0 10px 0;">Admin Aktif</p>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>
</header>

<div class="container">
    <div id="admin-panel" class="admin-box hidden">
        <h3 style="margin-top:0; font-size: 16px;">Tambah Box Baru</h3>
        <input type="text" id="new-title" placeholder="Judul">
        <textarea id="new-note" placeholder="Isi teks..." rows="4"></textarea>
        <button class="btn btn-login" onclick="addNote()">Simpan Box Baru</button>
    </div>
    <div id="notes-container" class="notes-grid"></div>
</div>

<script>
    // Konfigurasi Firebase (Tetap)
    const firebaseConfig = {
        apiKey: "AIzaSyC-cSIk3mraVl5sa24VcDWnRTpF50pBAoE",
        authDomain: "muzans-d76c4.firebaseapp.com",
        databaseURL: "https://muzans-d76c4-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "muzans-d76c4",
        storageBucket: "muzans-d76c4.firebasestorage.app",
        messagingSenderId: "1015626935627",
        appId: "1:1015626935627:web:47a1b5f0ce11838c5f0cce",
        measurementId: "G-775DH0L65X"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let isAdminGlobal = false;
    let currentEditingKey = null;

    window.onload = function() {
        const savedEmail = localStorage.getItem('admin_email');
        const savedPass = localStorage.getItem('admin_pass');
        if (savedEmail && savedPass) {
            document.getElementById('login-email').value = savedEmail;
            document.getElementById('login-pass').value = savedPass;
            document.getElementById('remember-check').checked = true;
        }
    };

    function login() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        const remember = document.getElementById('remember-check').checked;

        auth.signInWithEmailAndPassword(email, pass).then(() => {
            if (remember) {
                localStorage.setItem('admin_email', email);
                localStorage.setItem('admin_pass', pass);
            } else {
                localStorage.removeItem('admin_email');
                localStorage.removeItem('admin_pass');
            }
            document.getElementById('login-popup').classList.add('hidden');
        }).catch(err => alert("Gagal: " + err.message));
    }

    function logout() {
        document.getElementById('login-popup').classList.add('hidden');
        document.getElementById('logout-form').classList.add('hidden');
        document.getElementById('admin-panel').classList.add('hidden');
        auth.signOut().then(() => {
            setTimeout(() => { location.reload(); }, 100);
        });
    }

    function togglePopup(e) { e.stopPropagation(); document.getElementById('login-popup').classList.toggle('hidden'); }

    document.addEventListener('click', function(e) {
        const popup = document.getElementById('login-popup');
        const trigger = document.getElementById('login-trigger');
        if (popup && !popup.contains(e.target) && !trigger.contains(e.target)) popup.classList.add('hidden');
    });

    auth.onAuthStateChanged(user => {
        isAdminGlobal = !!user;
        document.getElementById('admin-panel').classList.toggle('hidden', !isAdminGlobal);
        document.getElementById('admin-label').classList.toggle('hidden', !isAdminGlobal);
        document.getElementById('login-form').classList.toggle('hidden', isAdminGlobal);
        document.getElementById('logout-form').classList.toggle('hidden', !isAdminGlobal);
        initSync();
    });

    function initSync() {
        const container = document.getElementById('notes-container');
        db.ref('notes').off();
        container.innerHTML = '';
        db.ref('notes').on('child_added', (snapshot) => {
            container.prepend(createCard(snapshot.key, snapshot.val()));
        });
        db.ref('notes').on('child_changed', (snapshot) => {
            const data = snapshot.val();
            const titleEl = document.getElementById(`title-${snapshot.key}`);
            const textEl = document.getElementById(`text-${snapshot.key}`);
            if(titleEl) titleEl.value = data.title;
            if(textEl) textEl.value = data.content;
            exitEdit(snapshot.key);
        });
        db.ref('notes').on('child_removed', (snapshot) => {
            const el = document.getElementById(`card-${snapshot.key}`);
            if(el) el.remove();
        });
    }

    function createCard(key, data) {
        const div = document.createElement('div');
        div.className = 'card';
        div.id = `card-${key}`;
        div.innerHTML = `
            <input type="text" id="title-${key}" class="card-title" readonly value="${data.title}">
            <textarea id="text-${key}" class="fixed-height" readonly onclick="copyText('${key}')">${data.content}</textarea>
            ${isAdminGlobal ? `
            <div class="card-actions">
                <button id="edit-${key}" class="btn btn-edit" onclick="enterEdit('${key}')">Edit</button>
                <button id="save-${key}" class="btn btn-save hidden" onclick="saveData('${key}')">Simpan</button>
                <button id="cancel-${key}" class="btn btn-cancel hidden" onclick="confirmCancel('${key}')">Batal</button>
                <button id="del-${key}" class="btn btn-delete" onclick="deleteData('${key}')"><i class="fas fa-trash"></i></button>
                <i id="status-${key}" class="fas fa-check-circle status-saved"></i>
            </div>
            ` : ''}
        `;
        return div;
    }

    function enterEdit(key) {
        if(currentEditingKey) return;
        currentEditingKey = key;
        document.getElementById(`title-${key}`).readOnly = false;
        document.getElementById(`title-${key}`).classList.add('editing');
        document.getElementById(`text-${key}`).readOnly = false;
        document.getElementById(`text-${key}`).classList.add('editing');
        document.getElementById(`edit-${key}`).classList.add('hidden');
        document.getElementById(`del-${key}`).classList.add('hidden');
        document.getElementById(`save-${key}`).classList.remove('hidden');
        document.getElementById(`cancel-${key}`).classList.remove('hidden');
    }

    function exitEdit(key) {
        currentEditingKey = null;
        const title = document.getElementById(`title-${key}`);
        const text = document.getElementById(`text-${key}`);
        if(title) { title.readOnly = true; title.classList.remove('editing'); }
        if(text) { text.readOnly = true; text.classList.remove('editing'); }
        if(document.getElementById(`edit-${key}`)) document.getElementById(`edit-${key}`).classList.remove('hidden');
        if(document.getElementById(`del-${key}`)) document.getElementById(`del-${key}`).classList.remove('hidden');
        if(document.getElementById(`save-${key}`)) document.getElementById(`save-${key}`).classList.add('hidden');
        if(document.getElementById(`cancel-${key}`)) document.getElementById(`cancel-${key}`).classList.add('hidden');
    }

    function saveData(key) {
        const t = document.getElementById(`title-${key}`).value;
        const c = document.getElementById(`text-${key}`).value;
        db.ref('notes/' + key).update({ title: t, content: c }).then(() => {
            const statusIcon = document.getElementById(`status-${key}`);
            statusIcon.style.display = 'block';
            setTimeout(() => { statusIcon.style.display = 'none'; }, 2000);
            exitEdit(key);
        });
    }

    function addNote() {
        const t = document.getElementById('new-title').value;
        const c = document.getElementById('new-note').value;
        if(c) {
            db.ref('notes').push({ title: t || "Untitled", content: c });
            document.getElementById('new-title').value = '';
            document.getElementById('new-note').value = '';
        }
    }

    function deleteData(key) { if(confirm('Hapus?')) db.ref('notes/' + key).remove(); }

    function copyText(key) {
        const el = document.getElementById(`text-${key}`);
        if(el.readOnly) {
            el.select(); document.execCommand('copy');
            const bg = el.style.background; el.style.background = '#d4edda';
            setTimeout(() => el.style.background = bg, 500);
        }
    }
</script>
</body>
</html>