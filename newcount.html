<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Counter Email</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; margin-top: 60px; }
        .container { max-width: 320px; margin: auto; }
        .flex { display: flex; justify-content: space-between; gap: 10px; }
        .input-field, .small-btn { width: 100%; padding: 8px; font-size: 16px; text-align: center; margin: 5px 0; box-sizing: border-box; }
        #resultBox, #emailInput, #nama-kombinasi { height: 40px; }
        #resultBox { margin-bottom: 40px; }
        #nama-kombinasi { margin-bottom: 10px; }
        .circle-btn { width: 70px; height: 70px; border-radius: 50%; font-size: 24px; font-weight: bold; border: none; cursor: pointer; transition: 0.2s; }
        .circle-btn:hover { opacity: 0.8; }
        .plus { background-color: #28a745; color: white; }
        .minus { background-color: #dc3545; color: white; }
        .counter-buttons { display: flex; align-items: center; justify-content: center; gap: 15px; margin-top: 10px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { display: none; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: white; transition: 0.4s; border-radius: 50%; }
        input:checked + .slider { background-color: #28a745; }
        input:checked + .slider:before { transform: translateX(26px); }
        .footer { margin-top: 20px; font-size: 14px; color: gray; }
        .message { font-size: 16px; color: #333; margin-top: 20px; }
        .spacer { margin-top: 32px; }
        .error-message { color: #dc3545; font-size: 14px; margin-top: 10px; display: none; }
        .acak-container { display: flex; justify-content: center; gap: 10px; } /* Untuk tata letak tombol Acak */
    </style>
</head>
<body>

<div class="container">
    <div class="flex">
        <button class="small-btn" onclick="reset()">Reset</button>
        <button class="small-btn" onclick="openMenu()">Menu</button>
    </div>

    <input type="number" id="startInput" class="input-field" placeholder="Start" oninput="autoSetLimits()">
    <input type="number" id="maxInput" class="input-field" placeholder="End" oninput="autoSetLimits()">
    <input type="email" id="emailInput" class="input-field" placeholder="Masukkan email" oninput="updateDisplay()">
    
    <input type="text" id="resultBox" class="input-field" readonly>
    
    <div class="counter-buttons">
        <button class="circle-btn minus" onclick="decrement()">−</button>
        <label class="switch">
            <input type="checkbox" id="toggleSwitch" onchange="toggleFormat()">
            <span class="slider"></span>
        </label>
        <button class="circle-btn plus" onclick="increment()">+</button>
    </div>

    <div class="spacer"></div>
    <input type="text" id="nama-kombinasi" class="input-field" placeholder="Nama acak" readonly>
    <div class="acak-container">
        <button class="small-btn" onclick="generateRandomName()">Acak</button>
    </div>
    <div id="errorMessage" class="error-message"></div>

    <div class="message">
        <p>☕</p>
    </div>
</div>

<div class="footer">Versi 6.0.0 Beta | Update 16-7-2025</div>

<script>
    let count = 0;
    let min = 0;
    let max = Infinity;
    let format = localStorage.getItem("toggleSwitch") === "true";
    const jsonUrl = "https://raw.githubusercontent.com/muzans/muzans.github.io/refs/heads/main/base.json";
    let firstNames = [];
    let lastNames = [];

    // Fungsi untuk menampilkan pesan error di UI
    function showError(message) {
        const errorDiv = document.getElementById("errorMessage");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
    }

    // Fungsi untuk menyembunyikan pesan error
    function hideError() {
        const errorDiv = document.getElementById("errorMessage");
        errorDiv.textContent = "";
        errorDiv.style.display = "none";
    }

    // Fungsi untuk mengambil data dari JSON
    async function fetchData() {
        try {
            const response = await fetch(jsonUrl);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            if (!data.FirstNames || !data.LastNames || !Array.isArray(data.FirstNames) || !Array.isArray(data.LastNames)) {
                throw new Error("Format JSON tidak valid: FirstNames atau LastNames tidak ditemukan atau bukan array.");
            }
            firstNames = data.FirstNames;
            lastNames = data.LastNames;
            hideError();
            generateRandomName(); // Generate nama acak setelah data diambil
        } catch (error) {
            showError("Gagal memuat data nama dari GitHub. Coba lagi nanti.");
            console.error("Error fetching data:", error);
        }
    }

    // Fungsi untuk mengacak nama
    function generateRandomName() {
        try {
            if (firstNames.length === 0 || lastNames.length === 0) {
                document.getElementById("nama-kombinasi").value = "Data nama belum tersedia.";
                showError("Data nama belum tersedia. Pastikan file JSON dapat diakses.");
                return;
            }

            // Ambil nama depan dan belakang secara acak
            const randomFirstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const randomLastName = lastNames[Math.floor(Math.random() * lastNames.length)];

            // Gabungkan menjadi nama lengkap
            const fullName = `${randomFirstName} ${randomLastName}`;
            document.getElementById("nama-kombinasi").value = fullName;
            localStorage.setItem("nama-kombinasi", fullName);

            // Salin ke clipboard
            autoCopy(fullName);
        } catch (e) {
            showError("Gagal menghasilkan nama acak.");
            console.error("Error in generateRandomName:", e);
        }
    }

    function autoSetLimits() {
        try {
            let newMin = parseInt(document.getElementById("startInput").value) || 0;
            let newMax = parseInt(document.getElementById("maxInput").value);

            min = newMin;
            max = isNaN(newMax) || newMax < min ? Infinity : newMax;
            count = min;

            localStorage.setItem("startInput", min);
            localStorage.setItem("maxInput", max);
            localStorage.setItem("emailInput", document.getElementById("emailInput").value);
            localStorage.setItem("count", count);
            
            updateDisplay();
        } catch (e) {
            console.error("Error in autoSetLimits:", e);
        }
    }

    function increment() {
        try {
            if (count >= max) {
                alert("Batas maksimum tercapai!");
                return;
            }
            count++;
            updateDisplay();
            autoCopy(document.getElementById("resultBox").value);
        } catch (e) {
            console.error("Error in increment:", e);
        }
    }

    function decrement() {
        try {
            if (count > min) {
                count--;
                updateDisplay();
                autoCopy(document.getElementById("resultBox").value);
            } else {
                alert("Batas minimum tercapai!");
            }
        } catch (e) {
            console.error("Error in decrement:", e);
        }
    }

    function updateDisplay() {
        try {
            const emailInput = document.getElementById("emailInput").value;
            localStorage.setItem("emailInput", emailInput);

            const emailParts = emailInput.split('@');
            const baseEmail = emailParts[0] || "";
            const domain = emailParts[1] ? `@${emailParts[1]}` : "";

            let newEmail = format ? `${count}${baseEmail}${domain}` : `${baseEmail}${count}${domain}`;
            
            document.getElementById("resultBox").value = newEmail;
            localStorage.setItem("count", count);
        } catch (e) {
            console.error("Error in updateDisplay:", e);
        }
    }

    function autoCopy(text) {
        try {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).catch((e) => {
                    console.error("Clipboard API failed:", e);
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        } catch (e) {
            console.error("Error in autoCopy:", e);
            alert("Gagal menyalin ke clipboard. Pastikan halaman dijalankan di localhost atau HTTPS.");
        }
    }

    function fallbackCopy(text) {
        try {
            const tempInput = document.createElement("textarea");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
        } catch (e) {
            console.error("Fallback copy failed:", e);
            alert("Gagal menyalin ke clipboard. Pastikan halaman dijalankan di localhost atau HTTPS.");
        }
    }

    function reset() {
        try {
            min = parseInt(document.getElementById("startInput").value) || 0;
            count = min;
            max = Infinity;

            document.getElementById("startInput").value = "";
            document.getElementById("maxInput").value = "";
            document.getElementById("emailInput").value = "";
            document.getElementById("resultBox").value = "";
            document.getElementById("nama-kombinasi").value = "";
            hideError();

            localStorage.clear();
            fetchData(); // Panggil ulang fetchData setelah reset
        } catch (e) {
            console.error("Error in reset:", e);
        }
    }

    function openMenu() {
        try {
            window.location.href = "https://muzans.github.io";
        } catch (e) {
            console.error("Error in openMenu:", e);
        }
    }

    function toggleFormat() {
        try {
            format = document.getElementById("toggleSwitch").checked;
            localStorage.setItem("toggleSwitch", format);
            updateDisplay();
        } catch (e) {
            console.error("Error in toggleFormat:", e);
        }
    }

    window.onload = function () {
        try {
            min = parseInt(localStorage.getItem("startInput")) || 0;
            max = parseInt(localStorage.getItem("maxInput")) || Infinity;
            count = parseInt(localStorage.getItem("count")) || min;

            document.getElementById("startInput").value = min;
            document.getElementById("maxInput").value = max === Infinity ? "" : max;
            document.getElementById("emailInput").value = localStorage.getItem("emailInput") || "";
            document.getElementById("toggleSwitch").checked = format;
            document.getElementById("nama-kombinasi").value = localStorage.getItem("nama-kombinasi") || "";

            updateDisplay();
            fetchData(); // Panggil fetchData saat halaman dimuat
        } catch (e) {
            console.error("Error in window.onload:", e);
            showError("Gagal memuat halaman. Coba muat ulang.");
        }
    };
</script>

</body>
</html>